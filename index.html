<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="assets/css/newstyle.css">
</head>

<body>
    <h1>Hanzi Converters</h1>
    <p>Input Simplified or Xinjianti characters into these converters. Note that Simplified characters have a "default" traditional form on which they fall back when they have multiple definitions, so it is recommended to first convert these specific characters into the intended traditional form before inputting. <a href="https://fareast-english.fandom.com/wiki/List_of_New_Simplified_Forms_of_Chinese_Characters">Here is a list of traditional characters which the converter recognizes.</a></p>
    <h2>Xinjianti Converter</h2>

    <form>
      <input type="text" id="fname" name="fname"><br><br>
      <input type="button" value="Convert" onclick="msg()">
    </form>
    
    <p id="demo">Enter a value above and click the button to convert it</p>

    <script>
        var csv = "";
        var dataArray;
        var request = new XMLHttpRequest();
        request.open('GET', 'https://EricL22.github.io/assets/data/xn-dict.csv', true);
        request.responseType = 'blob';
        request.onload = function() {
            var reader = new FileReader();
            reader.readAsText(request.response);
            reader.onload =  function(e){
                //console.log('Text:', e.target.result);
                csv = e.target.result;
        
                //var csv = '"foo, the column",bar\n2,3\n"4, the value",5',

                    // Split the input into lines
                    lines = csv.split('\n'),

                    // Extract column names from the first line
                    columnNamesLine = lines[0],
                    columnNames = parse(columnNamesLine),

                    // Extract data from subsequent lines
                    dataLines = lines.slice(1),
                    data = dataLines.map(parse);

                // Prints [["2","3"],["4, the value","5"]]
                dataArray = data;
                //console.log(JSON.stringify(dataArray));
            };
        };
        request.send();
        
        // Parse a CSV row, accounting for commas inside quotes                   
        function parse(row){
          var insideQuote = false,                                             
              entries = [],                                                    
              entry = [];
          row.split('').forEach(function (character) {                         
            if(character === '"') {
              insideQuote = !insideQuote;                                      
            } else {
              if(character == "," && !insideQuote) {                           
                entries.push(entry.join(''));                                  
                entry = [];                                                    
              } else {
                entry.push(character);                                         
              }                                                                
            }                                                                  
          });
          entries.push(entry.join(''));                                        
          return entries;                                                      
        }
        function msg() {
            const button = document.querySelector('input');
            const paragraph = document.getElementById("demo");
            var checkString = document.getElementById("fname").value;
            var output = "";
            while (checkString.length > 0)
            {
                OUTER_LOOP: for (let i = checkString.length; i > 0; i--)
                {
                    for (let j = 0; j < dataArray.length; j++)
                    {
                        for (let k = 0; k < dataArray[j].length; k++)
                        {
                            if (checkString.substring(0, i) == dataArray[j][k] && checkString.match(/^[0-9]+$/) == null)
                            {
                                if (dataArray[j][3] == "1")
                                    output += dataArray[j][2];
                                else if (dataArray[j][3] == "" || dataArray[j][3].match(/^[0-9]+$/) != null)
                                    output += dataArray[j][1];
                                else
                                    output += dataArray[j][3];
                                checkString = checkString.substring(i);
                                break OUTER_LOOP;
                            }
                            else if (j == dataArray.length - 1 && k == dataArray[j].length - 1 && i == 1)
                            {
                                output += checkString.substring(0, i);
                                checkString = checkString.substring(i);
                                break OUTER_LOOP;
                            }
                        }
                    }
                }
            }
            paragraph.textContent = output;
        }
    </script>

    <h2>Multilingual Dictionary</h2>
    <p>Test font 何故鞦甚榮？</p>
    <h3><a href="https://fareast-english.fandom.com/wiki/Xinjianti">Learn more about Xinjianti</a></h3>
</body>

</html>
