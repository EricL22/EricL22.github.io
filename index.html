<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="assets/css/newstyle.css">
</head>

<body>
    <h1>Hanzi Converters</h1>
    <p>Input Simplified characters into these converters; the Multilingual Dictionary also supports Xinjianti. Note that outside of fixed compounds, Simplified characters have a "default" traditional form on which they fall back when they have multiple definitions, so it is recommended to proofread these characters after conversion if they are used in isolation. <a href="https://fareast-english.fandom.com/wiki/List_of_New_Simplified_Forms_of_Chinese_Characters">Here is a list of traditional characters which the converter recognizes.</a></p>
    <h2>Xinjianti Converter</h2>

    <form>
      <input type="text" id="fname" name="fname"><br><br>
      <input type="button" value="Convert" onclick="msg()">
      <input type="button" value="Compatibility Mode" onclick="compat()">
    </form>
    
    <h5 id="compmode"><i></i></h5>
    <p id="demo">Enter a value above and click the button to convert it</p>

    <h2>Multilingual Dictionary</h2>
    <!-- <p>Test font 何故鞦甚榮？</p> -->
    <p>Japanese kun'yomi is supported, but not Vietnamese huấn độc nor Korean hundok unless they are nativizations of Sino-Xenic terms.</p>

    <form>
      <input type="text" id="termin" name="termin"><br><br>
      <input type="button" id="defbutton" value="Lookup" onclick="define()">
      <input type="button" id="vbutton" value="Vietnamese" onclick="makeViet()">
      <input type="button" id="kbutton" value="Korean" onclick="makeKor()">
      <input type="button" id="jbutton" value="Japanese" onclick="makeJap()">
      <input type="button" id="cbutton" value="Chinese" onclick="makeChi()">
      <input type="button" id="tlbutton" value="Sino-Xenic" onclick="makeTl()">
    </form>
    
    <p id="termout">Enter a single term to be defined</p>
    <p id="termout2"></p>

    <script>
        var compats = false;
        var viet = false;
        var kor = false;
        var jap = false;
        var chi = false;
        var tl = false;
        const button = document.getElementById("defbutton");
        const vbutton = document.getElementById("vbutton");
        const kbutton = document.getElementById("kbutton");
        const jbutton = document.getElementById("jbutton");
        const cbutton = document.getElementById("cbutton");
        const tlbutton = document.getElementById("tlbutton");
        button.disabled = true;
        var csv = "";
        var dataArray;
        var request = new XMLHttpRequest();
        request.open('GET', 'https://EricL22.github.io/assets/data/xn-dict.csv', true);
        request.responseType = 'blob';
        request.onload = function() {
            var reader = new FileReader();
            reader.readAsText(request.response);
            reader.onload =  function(e){
                //console.log('Text:', e.target.result);
                csv = e.target.result;
        
                //var csv = '"foo, the column",bar\n2,3\n"4, the value",5',

                    // Split the input into lines
                    lines = csv.split('\n'),

                    // Extract column names from the first line
                    columnNamesLine = lines[0],
                    columnNames = parse(columnNamesLine),

                    // Extract data from subsequent lines
                    dataLines = lines.slice(1),
                    data = dataLines.map(parse);

                // Prints [["2","3"],["4, the value","5"]]
                dataArray = data;
                //console.log(JSON.stringify(dataArray));
            };
        };
        request.send();
        
        // Parse a CSV row, accounting for commas inside quotes                   
        function parse(row){
          var insideQuote = false,                                             
              entries = [],                                                    
              entry = [];
          row.split('').forEach(function (character) {                         
            if(character === '"') {
              insideQuote = !insideQuote;                                      
            } else {
              if(character == "," && !insideQuote) {                           
                entries.push(entry.join(''));                                  
                entry = [];                                                    
              } else {
                entry.push(character);                                         
              }                                                                
            }                                                                  
          });
          entries.push(entry.join(''));                                        
          return entries;                                                      
        }
        function compat() {
            var x = document.getElementById("compmode");
            if (x.textContent === "") {
                x.textContent = new String("Compatibility Mode Enabled");
                x.style.fontStyle = "italic";
            } else {
                x.textContent = "";
            }
            compats = !compats;
        }
        function msg() {
            const MAX_STRING_SIZE = 15;
            const paragraph = document.getElementById("demo");
            var checkString = document.getElementById("fname").value;
            var output = "";
            paragraph.textContent = "Working...";
            setTimeout(function() {
                while (checkString.length > 0)
                {
                    OUTER_LOOP: for (let i = checkString.length; i > 0; i--)
                    {
                        if (checkString.substring(0, i).length > MAX_STRING_SIZE)   continue;
                        for (let j = 0; j < dataArray.length; j++)
                        {
                            for (let k = 0; k < dataArray[j].length; k++)
                            {
                                if (checkString.substring(0, i) == dataArray[j][k] && isNaN(checkString.substring(0, i)))
                                {
                                    if (dataArray[j][3] == "1" || compats && dataArray[j][4] == "1")
                                        output += dataArray[j][2];
                                    else if (dataArray[j][3] == "" || dataArray[j][3].match(/^[0-9]+$/) != null || compats && dataArray[j][4] == "0")
                                        output += dataArray[j][1];
                                    else
                                        output += dataArray[j][3];
                                    checkString = checkString.substring(i);
                                    break OUTER_LOOP;
                                }
                                else if (j == dataArray.length - 1 && k == dataArray[j].length - 1 && i == 1)
                                {
                                    output += checkString.substring(0, i);
                                    checkString = checkString.substring(i);
                                    break OUTER_LOOP;
                                }
                            }
                        }
                    }
                }
                paragraph.textContent = output;
            }, 1);
        }
        function makeViet() {
            viet = true;
            kor = false;
            jap = false;
            chi = false;
            tl = false;
            vbutton.disabled = true;
            jbutton.disabled = false;
            kbutton.disabled = false;
            cbutton.disabled = false;
            tlbutton.disabled = false;
            button.disabled = false;
        }
        function makeKor() {
            kor = true;
            viet = false;
            jap = false;
            chi = false;
            tl = false;
            vbutton.disabled = false;
            jbutton.disabled = false;
            kbutton.disabled = true;
            cbutton.disabled = false;
            tlbutton.disabled = false;
            button.disabled = false;
        }
        function makeJap() {
            jap = true;
            viet = false;
            kor = false;
            chi = false;
            tl = false;
            vbutton.disabled = false;
            jbutton.disabled = true;
            kbutton.disabled = false;
            cbutton.disabled = false;
            tlbutton.disabled = false;
            button.disabled = false;
        }
        function makeChi() {
            chi = true;
            viet = false;
            kor = false;
            jap = false;
            tl = false;
            vbutton.disabled = false;
            jbutton.disabled = false;
            kbutton.disabled = false;
            cbutton.disabled = true;
            tlbutton.disabled = false;
            button.disabled = false;
        }
        function makeTl() {
            tl = true;
            viet = false;
            kor = false;
            jap = false;
            chi = false;
            vbutton.disabled = false;
            jbutton.disabled = false;
            kbutton.disabled = false;
            cbutton.disabled = false;
            tlbutton.disabled = true;
            button.disabled = false;
        }
        function define() {
            const paragraph = document.getElementById("termout");
            const paragraph2 = document.getElementById("termout2");
            var checkString = document.getElementById("termin").value;
            var output = "";
            var output2 = "";
            OUTER_LOOP: for (let j = 0; j < dataArray.length; j++)
            {
                for (let k = 0; k < dataArray[j].length; k++)
                {
                    if (checkString == dataArray[j][k] && isNaN(checkString))
                    {
                        if (tl)
                        {
                            output += "（";
                            if (dataArray[j][3] == "1")
                                output += dataArray[j][2];
                            else if (dataArray[j][3] == "" || dataArray[j][3].match(/^[0-9]+$/) != null)
                                output += dataArray[j][1];
                            else
                                output += dataArray[j][3];
                            output += "）<br>";
                            output += "Chinese: ";
                            if (dataArray[j][8] == "") output += "No reading found<br>";
                            else output += dataArray[j][8] + "<br>";
                            output += "Japanese: ";
                            if (dataArray[j][7] == "") output += "No reading found<br>";
                            else output += dataArray[j][7] + "<br>";
                            output += "Korean: ";
                            if (dataArray[j][6] == "") output += "No reading found<br>";
                            else output += dataArray[j][6] + "<br>";
                            output += "Vietnamese: ";
                            if (dataArray[j][5] == "") output += "No reading found";
                            else output += dataArray[j][5];
                        }
                        else if (viet && dataArray[j][5] == "" || kor && dataArray[j][6] == "" || jap && dataArray[j][7] == "" || chi && dataArray[j][8] == "")
                            output = "No reading found";
                        else
                        {
                            if (viet) output += dataArray[j][5];
                            if (kor) output += dataArray[j][6];
                            if (jap) output += dataArray[j][7];
                            if (chi) output += dataArray[j][8];
                            output += "（";
                            if (dataArray[j][3] == "1")
                                output += dataArray[j][2];
                            else if (dataArray[j][3] == "" || dataArray[j][3].match(/^[0-9]+$/) != null)
                                output += dataArray[j][1];
                            else
                                output += dataArray[j][3];
                            output += "）";
                        }
                        
                        if ((viet && dataArray[j][10] == "" || kor && dataArray[j][11] == "" || jap && dataArray[j][12] == "" || chi && dataArray[j][13] == "" || tl) && dataArray[j][9] == "")
                        {
                            output2 = "No definitions found";
                            paragraph2.style.fontStyle = "italic";
                        }
                        else
                        {
                            if (viet) output2 += dataArray[j][10];
                            if (kor) output2 += dataArray[j][11];
                            if (jap) output2 += dataArray[j][12];
                            if (chi) output2 += dataArray[j][13];
                            if (output2 == "") output2 += dataArray[j][9];
                            paragraph2.style.fontStyle = "normal";
                        }
                        break OUTER_LOOP;
                    }
                    else if (j == dataArray.length - 1 && k == dataArray[j].length - 1)
                    {
                        output2 = "No matches found";
                        paragraph2.style.fontStyle = "normal";
                    }
                }
            }
            paragraph.innerHTML = output;
            paragraph2.innerHTML = output2;
        }
    </script>
    
    <h3><a href="https://fareast-english.fandom.com/wiki/Xinjianti">Learn more about Xinjianti</a></h3>
</body>

</html>
